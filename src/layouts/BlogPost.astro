---
import Layout from "./Layout.astro";
import NewsletterSignUp from "../components/NewsletterSignUp.astro";
import { getReadingTime } from "../lib/readingTime";

const { content, rawContent } = Astro.props;

const { title, description, publishedOn, image, permalink, slug, keywords } =
  content;

const pageTitle = `${title} - Brock Herion`;

const allPosts = await Astro.glob("../pages/blog/posts/*.md");
const filteredPosts = allPosts
  .filter(
    (post) => post.frontmatter.slug !== slug && post.frontmatter.isPublished
  )
  .sort(
    (a, b) =>
      new Date(b.frontmatter.publishedOn).valueOf() -
      new Date(a.frontmatter.publishedOn).valueOf()
  )
  .slice(0, 3);
---

<Layout content={{ title: pageTitle, description, permalink, image, keywords }}>
  <div>
    <img
      src={image}
      width={1600}
      height={840}
      alt={title}
      class="rounded mb-1"
    />
    <div class="w-full text-center">
      <h1 class="text-3xl py-6 flex flex-col items-center">
        {title}
        <div class="w-16 h-2 mt-4 bg-emerald-400"></div>
      </h1>
      <p class="italic">
        {publishedOn} - {getReadingTime(rawContent())} minute read
      </p>
    </div>

    <div>
      <article
        class="flex flex-col my-6 tracking-wider max-w-prose mx-auto post"
      >
        <slot />
      </article>
      <NewsletterSignUp />
      <section>
        <h3 class="text-2xl mb-3">More Articles ðŸ“°</h3>
        <div class="grid md:grid-cols-3 gap-x-4 gap-y-4">
          {
            filteredPosts.map((post) => (
              <a href={`/blog/posts/${post.frontmatter.slug}`}>
                <div class="h-80 bg-emerald-400/10 shadow dark:shadow-none rounded overflow-hidden border border-emerald-400 px-2">
                  <h5 class="text-xl mt-3 mb-2 px-2 line-clamp-2">
                    {post.frontmatter.title}
                  </h5>
                  <img
                    src={post.frontmatter.image}
                    height="168"
                    width="320"
                    class="rounded mb-2"
                    alt={post.frontmatter.title}
                  />
                  <p class="px-2 line-clamp-3 opacity-70">
                    {post.frontmatter.description}
                  </p>
                </div>
              </a>
            ))
          }
        </div>
      </section>
    </div>
  </div>
</Layout>
